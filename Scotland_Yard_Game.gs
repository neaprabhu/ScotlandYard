
var station_row = new Array(199)
var station_col = new Array(199)

// Station Row Number
station_row[0] = 2
station_row[1] = 2//1
station_row[2] = 2//1
station_row[3] = 2//1
station_row[4] = 2
station_row[5] = 2
station_row[6] = 2
station_row[7] = 5
station_row[8] = 5
station_row[9] = 5
station_row[10] = 6
station_row[11] = 5
station_row[12] = 5
station_row[13] = 3
station_row[14] = 3
station_row[15] = 5
station_row[16] = 7
station_row[17] = 7
station_row[18] = 8
station_row[19] = 6
station_row[20] = 9
station_row[21] = 9
station_row[22] = 7
station_row[23] = 7
station_row[24] = 8
station_row[25] = 5
station_row[26] = 8
station_row[27] = 6
station_row[28] = 8
station_row[29] = 8
station_row[30] = 9
station_row[31] = 11
station_row[32] = 10
station_row[33] = 11
station_row[34] = 12
station_row[35] = 13
station_row[36] = 10
station_row[37] = 10
station_row[38] = 9
station_row[39] = 12
station_row[40] = 11
station_row[41] = 11
station_row[42] = 12
station_row[43] = 13
station_row[44] = 14
station_row[45] = 13
station_row[46] = 12
station_row[47] = 14
station_row[48] = 14
station_row[49] = 13
station_row[50] = 13
station_row[51] = 12
station_row[52] = 14
station_row[53] = 13
station_row[54] = 13
station_row[55] = 14
station_row[56] = 14
station_row[57] = 15
station_row[58] = 16
station_row[59] = 16
station_row[60] = 17
station_row[61] = 16
station_row[62] = 19
station_row[63] = 18
station_row[64] = 18
station_row[65] = 17
station_row[66] = 16
station_row[67] = 16
station_row[68] = 15
station_row[69] = 16
station_row[70] = 16
station_row[71] = 17
station_row[72] = 17
station_row[73] = 19
station_row[74] = 19
station_row[75] = 19
station_row[76] = 21
station_row[77] = 20
station_row[78] = 20
station_row[79] = 21
station_row[80] = 22
station_row[81] = 20
station_row[82] = 20
station_row[83] = 19
station_row[84] = 18
station_row[85] = 19
station_row[86] = 21
station_row[87] = 21
station_row[88] = 19
station_row[89] = 19
station_row[90] = 19
station_row[91] = 22
station_row[92] = 24
station_row[93] = 23
station_row[94] = 22
station_row[95] = 24
station_row[96] = 23
station_row[97] = 22
station_row[98] = 22
station_row[99] = 24
station_row[100] = 22
station_row[101] = 20
station_row[102] = 19
station_row[103] = 22
station_row[104] = 22
station_row[105] = 23
station_row[106] = 23
station_row[107] = 27
station_row[108] = 27
station_row[109] = 24
station_row[110] = 26
station_row[111] = 25
station_row[112] = 26
station_row[113] = 25
station_row[114] = 23
station_row[115] = 26
station_row[116] = 28
station_row[117] = 29
station_row[118] = 30
station_row[119] = 32
station_row[120] = 32
station_row[121] = 32
station_row[122] = 32
station_row[123] = 31
station_row[124] = 28
station_row[125] = 26
station_row[126] = 28
station_row[127] = 37
station_row[128] = 30
station_row[129] = 31
station_row[130] = 29
station_row[131] = 29
station_row[132] = 32
station_row[133] = 31
station_row[134] = 31
station_row[135] = 34
station_row[136] = 34
station_row[137] = 33
station_row[138] = 33
station_row[139] = 32
station_row[140] = 33
station_row[141] = 34
station_row[142] = 33
station_row[143] = 38
station_row[144] = 38
station_row[145] = 37
station_row[146] = 37
station_row[147] = 36
station_row[148] = 36
station_row[149] = 34
station_row[150] = 36
station_row[151] = 34
station_row[152] = 37
station_row[153] = 35
station_row[154] = 38
station_row[155] = 38
station_row[156] = 38
station_row[157] = 36
station_row[158] = 43
station_row[159] = 38
station_row[160] = 37
station_row[161] = 38
station_row[162] = 39
station_row[163] = 39
station_row[164] = 40
station_row[165] = 39
station_row[166] = 40
station_row[167] = 41
station_row[168] = 41
station_row[169] = 41
station_row[170] = 48
station_row[171] = 41
station_row[172] = 42
station_row[173] = 41
station_row[174] = 43
station_row[175] = 42
station_row[176] = 41
station_row[177] = 41
station_row[178] = 42
station_row[179] = 43
station_row[180] = 41
station_row[181] = 42
station_row[182] = 41
station_row[183] = 43
station_row[184] = 46
station_row[185] = 45
station_row[186] = 44
station_row[187] = 44
station_row[188] = 46
station_row[189] = 48
station_row[190] = 45
station_row[191] = 49
station_row[192] = 45
station_row[193] = 46
station_row[194] = 46
station_row[195] = 44
station_row[196] = 47
station_row[197] = 49
station_row[198] = 49

// Station Column Number
station_col[0] = 24
station_col[1] = 60
station_col[2] = 83
station_col[3] = 97
station_col[4] = 153
station_col[5] = 170
station_col[6] = 187
station_col[7] = 17
station_col[8] = 31
station_col[9] = 71
station_col[10] = 82
station_col[11] = 91
station_col[12] = 107
station_col[13] = 124
station_col[14] = 140
station_col[15] = 156
station_col[16] = 185
station_col[17] = 9
station_col[18] = 23
station_col[19] = 39
station_col[20] = 55
station_col[21] = 83
station_col[22] = 95
station_col[23] = 117
station_col[24] = 125
station_col[25] = 138
station_col[26] = 141
station_col[27] = 148
station_col[28] = 169
station_col[29] = 191
station_col[30] = 15
station_col[31] = 34
station_col[32] = 48
station_col[33] = 72
station_col[34] = 87
station_col[35] = 93
station_col[36] = 102
station_col[37] = 121
station_col[38] = 129
station_col[39] = 145
station_col[40] = 150
station_col[41] = 185
station_col[42] = 5
station_col[43] = 24
station_col[44] = 39
station_col[45] = 51
station_col[46] = 60
station_col[47] = 75
station_col[48] = 98
station_col[49] = 107
station_col[50] = 126
station_col[51] = 136
station_col[52] = 146
station_col[53] = 153
station_col[54] = 170
station_col[55] = 192
station_col[56] = 12
station_col[57] = 31
station_col[58] = 34
station_col[59] = 42
station_col[60] = 54
station_col[61] = 60
station_col[62] = 77
station_col[63] = 87
station_col[64] = 97
station_col[65] = 103
station_col[66] = 114
station_col[67] = 128
station_col[68] = 140
station_col[69] = 154
station_col[70] = 168
station_col[71] = 183
station_col[72] = 12
station_col[73] = 19
station_col[74] = 27
station_col[75] = 39
station_col[76] = 47
station_col[77] = 56
station_col[78] = 63
station_col[79] = 79
station_col[80] = 94
station_col[81] = 99
station_col[82] = 111
station_col[83] = 121
station_col[84] = 128
station_col[85] = 141
station_col[86] = 154
station_col[87] = 161
station_col[88] = 166
station_col[89] = 176
station_col[90] = 191
station_col[91] = 7
station_col[92] = 8
station_col[93] = 20
station_col[94] = 26
station_col[95] = 54
station_col[96] = 59
station_col[97] = 67
station_col[98] = 75
station_col[99] = 89
station_col[100] = 102
station_col[101] = 119
station_col[102] = 130
station_col[103] = 141
station_col[104] = 172
station_col[105] = 184
station_col[106] = 193
station_col[107] = 169
station_col[108] = 62
station_col[109] = 72
station_col[110] = 78
station_col[111] = 81
station_col[112] = 94
station_col[113] = 103
station_col[114] = 119
station_col[115] = 141
station_col[116] = 157
station_col[117] = 142
station_col[118] = 189
station_col[119] = 7
station_col[120] = 13
station_col[121] = 23
station_col[122] = 47
station_col[123] = 60
station_col[124] = 86
station_col[125] = 110
station_col[126] = 128
station_col[127] = 150
station_col[128] = 156
station_col[129] = 82
station_col[130] = 89
station_col[131] = 105
station_col[132] = 121
station_col[133] = 133
station_col[134] = 161
station_col[135] = 184
station_col[136] = 38
station_col[137] = 64
station_col[138] = 81
station_col[139] = 103
station_col[140] = 125
station_col[141] = 141
station_col[142] = 156
station_col[143] = 9
station_col[144] = 15
station_col[145] = 26
station_col[146] = 32
station_col[147] = 42
station_col[148] = 50
station_col[149] = 59
station_col[150] = 63
station_col[151] = 70
station_col[152] = 74
station_col[153] = 90
station_col[154] = 95
station_col[155] = 106
station_col[156] = 115
station_col[157] = 130
station_col[158] = 132
station_col[159] = 162
station_col[160] = 176
station_col[161] = 195
station_col[162] = 24
station_col[163] = 34
station_col[164] = 52
station_col[165] = 71
station_col[166] = 86
station_col[167] = 91
station_col[168] = 106
station_col[169] = 114
station_col[170] = 172
station_col[171] = 146
station_col[172] = 165
station_col[173] = 183
station_col[174] = 192
station_col[175] = 5
station_col[176] = 13
station_col[177] = 28
station_col[178] = 44
station_col[179] = 55
station_col[180] = 66
station_col[181] = 71
station_col[182] = 82
station_col[183] = 101
station_col[184] = 111
station_col[185] = 124
station_col[186] = 141
station_col[187] = 158
station_col[188] = 15
station_col[189] = 23
station_col[190] = 34
station_col[191] = 36
station_col[192] = 62
station_col[193] = 66
station_col[194] = 74
station_col[195] = 86
station_col[196] = 87
station_col[197] = 132
station_col[198] = 161

var mySheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Main')
var mrxSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Mr X')
var myDrawings = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Main').getDrawings()
var orow = -1
var ocol = -4
var xSheet_2xMoves = ['G12', 'G4','G5','G6','G7','G8','G9','G10','H4','H5','H6','H7','H8','H9','H10','I4','I5','I6','I7','I8','I9','I10','J4','J5','J6']
var xSheet_moves = ['C12', 'C4','C5','C6','C7','C8','C9','C10','D4','D5','D6','D7','D8','D9','D10','E4','E5','E6','E7','E8','E9','E10','F4','F5','F6']
var x_2xmoves = ['HN12', 'HI4','HI5','HI6','HI7','HI8','HI9','HL10','HL4','HL5','HL6','HL7','HL8','HL9','HO10','HO4','HO5','HO6','HO7','HO8','HO9','HR10','HR4','HR5','HR6']
var moves = [['GY12', 'GT4','GT5','GT6','GT7','GT8','GT9','GT10','GW4','GW5','GW6','GW7','GW8','GW9','GW10','GZ4','GZ5','GZ6','GZ7','GZ8','GZ9','GZ10','HC4','HC5','HC6'],
             ['HM25', 'HM14','HM15','HM16','HM17','HM18','HM19','HM20','HM21','HM22','HM23','HN14','HN15','HN16','HN17','HN18','HN19','HN20','HN21','HN22','HN23','HO14','HO15','HO16','HO17'],
             ['HN38', 'HN27','HN28','HN29','HN30','HN31','HN32','HN33','HN34','HN35','HN36','HO27','HO28','HO29','HO30','HO31','HO32','HO33','HO34','HO35','HO36','HP27','HP28','HP29','HP30'],
             ['HN51', 'HN40','HN41','HN42','HN43','HN44','HN45','HN46','HN47','HN48','HN49','HO40','HO41','HO42','HO43','HO44','HO45','HO46','HO47','HO48','HO49','HP40','HP41','HP42','HP43'],
             ['IM25', 'IM14','IM15','IM16','IM17','IM18','IM19','IM20','IM21','IM22','IM23','IN14','IN15','IN16','IN17','IN18','IN19','IN20','IN21','IN22','IN23','IO14','IO15','IO16','IO17'],
             ['IN38', 'IN27','IN28','IN29','IN30','IN31','IN32','IN33','IN34','IN35','IN36','IO27','IO28','IO29','IO30','IO31','IO32','IO33','IO34','IO35','IO36','IP27','IP28','IP29','IP30'],
             ['IN51', 'IN40','IN41','IN42','IN43','IN44','IN45','IN46','IN47','IN48','IN49','IO40','IO41','IO42','IO43','IO44','IO45','IO46','IO47','IO48','IO49','IP40','IP41','IP42','IP43']];
var taxi_budget = [4, 10, 10, 10, 10, 10, 10, 10]
var taxi_balance = ['A3', 'GT16', 'GU29', 'GU42','HT16', 'HU29','HU42']
var bus_budget = [3, 8, 8, 8, 8, 8, 8, 8]
var bus_balance = ['B3', 'HA16', 'HB29', 'HB42','IA16', 'IB29','IB42']
var metro_budget = [3, 4, 4, 4, 4, 4, 4, 4]
var metro_balance = ['E3', 'HH16', 'HI29', 'HI42','IH16', 'II29','II42']
var black_budget = [6, 0, 0, 0, 0, 0, 0, 0]
var black_balance = ['H3', '', '', '','', '','']
var x2_budget = [2, 0, 0, 0, 0, 0, 0, 0]
var x2_balance = ['K3', '', '', '','', '','']
var x_stuff = ['A3','B3','E3','H3','K3']
var wildcard = ['A5', '', '', '','', '','']
var tm = ['A4', 'GT17', 'GU30', 'GU43','HT17', 'HU30','HU43']
var position = ['A6', 'GT18', 'GU31', 'GU44','HT18', 'HU31','HU44']
var new_position = [0, 0, 0, 0, 0, 0, 0, 0]
var font_position = ['black', 'black', 'black','black','black','black','black']
var font_move = ['black', 'black', 'black','black','black','black','black']
var bg = ['white', 'white', 'white', 'white', 'white', 'white', 'white' ]
var d_wins = ['red', 'green', 'green', 'green', 'green', 'green', 'green']
var d_win_profile = [[24, 101],[12, 80],[12, 133],[18, 90],[32, 119],[36, 80],[36, 133]];
var x_wins = ['green', 'red', 'red', 'red', 'red', 'red', 'red']
var i
var y
var max_players = 7
var max_moves = 25
var parking = [[5, 234], [14, 261], [20, 261], [26, 261], [32, 261], [38, 261], [44, 261]];
var mv_counter = 'IT2'
var move_flag = ['JQ2', 'JQ3', 'JQ4', 'JQ5', 'JQ6', 'JQ7', 'JQ8']
var statusbox = 'B52'
var gameProperties = PropertiesService.getScriptProperties()

function parkrings(){
  var a = 0
  var b = -2
  
  for(i=0; i<max_players; i++){
    
    myDrawings[2*i].setPosition(parking[i][0]+a, parking[i][1]+b, 0, 0)
  }
  
  
}

function updatestatusbox(msg){
  mySheet.getRange(statusbox).setValue(msg)
}

function clearstatusbox(){
  mySheet.getRange(statusbox).clearContent()
}

function movering(drawingnumber, x_coord, y_coord, x_off, y_off){
  
  myDrawings[drawingnumber].setPosition(x_coord, y_coord, x_off, y_off)
}

function ResetSheet(){
  
  clearstatusbox()
  gameProperties.setProperty('global_counter', '0')
  global_counter = 0
  for(i = 0; i < max_players; i++){
    
    //Set Budgets
    if(i==0){
     
      mrxSheet.getRange(taxi_balance[i]).setValue(taxi_budget[i])
      mrxSheet.getRange(bus_balance[i]).setValue(bus_budget[i])
      mrxSheet.getRange(metro_balance[i]).setValue(metro_budget[i])
      mrxSheet.getRange(black_balance[i]).setValue(black_budget[i])
      mrxSheet.getRange(x2_balance[i]).setValue(x2_budget[i])
      mrxSheet.getRange(wildcard[i]).clearContent()
      
      mrxSheet.getRange(tm[i]).clearContent()
      mrxSheet.getRange(position[i]).clearContent()
      mrxSheet.getRange(position[i]).setBackground(bg[i])
      mrxSheet.getRange(position[i]).setFontColor(font_position[i])
      
      mySheet.getRange(move_flag[i]).setValue("X")
      mySheet.getRange(move_flag[i]).setBackground("white")
      mySheet.getRange(move_flag[i]).setFontColor("black")
      
    }else{
      mySheet.getRange(taxi_balance[i]).setValue(taxi_budget[i])
      mySheet.getRange(bus_balance[i]).setValue(bus_budget[i])
      mySheet.getRange(metro_balance[i]).setValue(metro_budget[i])
        
      mySheet.getRange(tm[i]).clearContent()
      mySheet.getRange(position[i]).clearContent()
      mySheet.getRange(position[i]).setBackground(bg[i])
      mySheet.getRange(position[i]).setFontColor(font_position[i])
      
      mySheet.getRange(move_flag[i]).setValue("D"+i.toString())
      mySheet.getRange(move_flag[i]).setBackground("white")
      mySheet.getRange(move_flag[i]).setFontColor("black")
    
    }
    
    for(y = 0; y <  max_moves; y++){
      
      //Mr X Sheet updates
      if(i == 0){
      
        mrxSheet.getRange(xSheet_moves[y]).setBackground(bg[i])
        mrxSheet.getRange(xSheet_moves[y]).setFontColor(font_move[i])
        mrxSheet.getRange(xSheet_moves[y]).setValue(y)
        mrxSheet.getRange(xSheet_2xMoves[y]).setBackground(bg[i])
        mrxSheet.getRange(xSheet_2xMoves[y]).setValue(y)
      }
      
      //Main Sheet Updates
      mySheet.getRange(moves[i][y]).setBackground(bg[i])
      mySheet.getRange(moves[i][y]).setFontColor(font_move[i])
      mySheet.getRange(moves[i][y]).setValue(y)
      mySheet.getRange(x_2xmoves[y]).setBackground(bg[i])
      mySheet.getRange(x_2xmoves[y]).setValue(y)
      
    }
    
  }
  parkrings()
  mySheet.getRange(mv_counter).clearContent()
  mySheet.getRange(mv_counter).setBackground("white")
  mySheet.getRange(mv_counter).setFontColor("black")
  mySheet.getRange(statusbox).clearContent()
  mySheet.getRange(statusbox).setValue("WELCOME TO SCOTLAND YARD!!")
    
}

function move_zero(){
  
  var move0 = [0, 0, 0, 0, 0, 0, 0]
  var flag = 0
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  
  for(i=0; i<max_players; i++){
    if(i==0){
      move0[i] = Math.floor((Math.random()*199)+1)    
    }else{
      do{
        move0[i] = Math.floor((Math.random()*199)+1)
        for(y=0; y<i;y++){
          if(move0[i]==move0[y]){
            flag =1
          }
        }
          
      }while(flag==1)
      
    }
    if(i == 0){
      
      mrxSheet.getRange(position[i]).setBackground(bg[i])
      mrxSheet.getRange(position[i]).setFontColor(font_position[i])
      mrxSheet.getRange(position[i]).setValue(move0[i])
      
      mySheet.getRange(moves[i][0]).setBackground("white")
      mySheet.getRange(moves[i][0]).setFontColor("white")
      mySheet.getRange(moves[i][0]).setValue(move0[i])
      mrxSheet.getRange(xSheet_moves[0]).setBackground("white")
      mrxSheet.getRange(xSheet_moves[0]).setFontColor("black")
      mrxSheet.getRange(xSheet_moves[0]).setValue(move0[i])
    
    }else{
      mySheet.getRange(position[i]).setBackground(bg[i])
      mySheet.getRange(position[i]).setFontColor(font_position[i])
      mySheet.getRange(position[i]).setValue(move0[i])
      
      movering(2*i, station_row[move0[i] - 1] + orow, station_col[move0[i] - 1] + ocol, 0, 0)
      mySheet.getRange(moves[i][0]).setBackground(bg[i])
      mySheet.getRange(moves[i][0]).setFontColor(font_move[i])
      mySheet.getRange(moves[i][0]).setValue(move0[i])
    
    }
    
  }
    
  idx += 1
  mySheet.getRange(mv_counter).setValue(idx)
  gameProperties.setProperty('global_counter', idx.toString());
  global_counter = idx
}


  
function d1_move_update(){
 
  clearstatusbox()
  new_position[1] = mySheet.getRange(position[1]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[1][idx-1]).getValue()
  if(new_position[1] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[1]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[1]).setBackground(bg[1])  
    movering(2, station_row[new_position[1]-1] + orow, station_col[new_position[1] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[1][idx]).setValue(new_position[1])
    mySheet.getRange(move_flag[1]).setFontColor("green")
    mySheet.getRange(move_flag[1]).setBackground("green")    
    mySheet.getRange(move_flag[1]).setValue(1)
    if(mySheet.getRange(tm[1]).getValue()=="TAXI"){
      mySheet.getRange(moves[1][idx]).setBackground("yellow")
      mySheet.getRange(moves[1][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[1]).getValue()=="BUS"){
      mySheet.getRange(moves[1][idx]).setBackground("green")
      mySheet.getRange(moves[1][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[1][idx]).setBackground("pink")
      mySheet.getRange(moves[1][idx]).setFontColor("black")
    }
    
  }
  
}

function d2_move_update(){
 
  clearstatusbox()
  new_position[2] = mySheet.getRange(position[2]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[2][idx-1]).getValue()
  if(new_position[2] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[2]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[2]).setBackground(bg[2])  
    movering(4, station_row[new_position[2]-1] + orow, station_col[new_position[2] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[2][idx]).setValue(new_position[2])
    mySheet.getRange(move_flag[2]).setFontColor("green")
    mySheet.getRange(move_flag[2]).setBackground("green")    
    mySheet.getRange(move_flag[2]).setValue(1)
    if(mySheet.getRange(tm[2]).getValue()=="TAXI"){
      mySheet.getRange(moves[2][idx]).setBackground("yellow")
      mySheet.getRange(moves[2][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[2]).getValue()=="BUS"){
      mySheet.getRange(moves[2][idx]).setBackground("green")
      mySheet.getRange(moves[2][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[2][idx]).setBackground("pink")
      mySheet.getRange(moves[2][idx]).setFontColor("black")
    }
    
  }
  
}

function d3_move_update(){
 
  clearstatusbox()
  new_position[3] = mySheet.getRange(position[3]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[3][idx-1]).getValue()
  if(new_position[3] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[3]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[3]).setBackground(bg[3])  
    movering(6, station_row[new_position[3]-1] + orow, station_col[new_position[3] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[3][idx]).setValue(new_position[3])
    mySheet.getRange(move_flag[3]).setFontColor("green")
    mySheet.getRange(move_flag[3]).setBackground("green")    
    mySheet.getRange(move_flag[3]).setValue(1)
    if(mySheet.getRange(tm[3]).getValue()=="TAXI"){
      mySheet.getRange(moves[3][idx]).setBackground("yellow")
      mySheet.getRange(moves[3][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[3]).getValue()=="BUS"){
      mySheet.getRange(moves[3][idx]).setBackground("green")
      mySheet.getRange(moves[3][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[3][idx]).setBackground("pink")
      mySheet.getRange(moves[3][idx]).setFontColor("black")
    }
    
  }
  
}

function d4_move_update(){
 
  clearstatusbox()
  new_position[4] = mySheet.getRange(position[4]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[4][idx-1]).getValue()
  if(new_position[4] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[4]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[4]).setBackground(bg[4])  
    movering(8, station_row[new_position[4]-1] + orow, station_col[new_position[4] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[4][idx]).setValue(new_position[4])
    mySheet.getRange(move_flag[4]).setFontColor("green")
    mySheet.getRange(move_flag[4]).setBackground("green")    
    mySheet.getRange(move_flag[4]).setValue(1)
    if(mySheet.getRange(tm[4]).getValue()=="TAXI"){
      mySheet.getRange(moves[4][idx]).setBackground("yellow")
      mySheet.getRange(moves[4][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[4]).getValue()=="BUS"){
      mySheet.getRange(moves[4][idx]).setBackground("green")
      mySheet.getRange(moves[4][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[4][idx]).setBackground("pink")
      mySheet.getRange(moves[4][idx]).setFontColor("black")
    }
    
  }
  
}

function d5_move_update(){
 
  clearstatusbox()
  new_position[5] = mySheet.getRange(position[5]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[5][idx-1]).getValue()
  if(new_position[5] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[5]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[5]).setBackground(bg[5])  
    movering(10, station_row[new_position[5]-1] + orow, station_col[new_position[5] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[5][idx]).setValue(new_position[5])
    mySheet.getRange(move_flag[5]).setFontColor("green")
    mySheet.getRange(move_flag[5]).setBackground("green")    
    mySheet.getRange(move_flag[5]).setValue(1)
    if(mySheet.getRange(tm[5]).getValue()=="TAXI"){
      mySheet.getRange(moves[5][idx]).setBackground("yellow")
      mySheet.getRange(moves[5][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[5]).getValue()=="BUS"){
      mySheet.getRange(moves[5][idx]).setBackground("green")
      mySheet.getRange(moves[5][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[5][idx]).setBackground("pink")
      mySheet.getRange(moves[5][idx]).setFontColor("black")
    }
    
  }
  
  
}

function d6_move_update(){
 
  clearstatusbox()
  new_position[6] = mySheet.getRange(position[6]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mySheet.getRange(moves[6][idx-1]).getValue()
  if(new_position[6] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mySheet.getRange(position[6]).setBackground("red")
    updatestatusbox("This move cannot happen because the new position has not been updated by the player/detective. Please correct")
    
  }else{
    mySheet.getRange(position[6]).setBackground(bg[6])  
    movering(12, station_row[new_position[6]-1] + orow, station_col[new_position[6] - 1] + ocol, 0, 0)
    mySheet.getRange(moves[6][idx]).setValue(new_position[6])
    mySheet.getRange(move_flag[6]).setFontColor("green")
    mySheet.getRange(move_flag[6]).setBackground("green")    
    mySheet.getRange(move_flag[6]).setValue(1)
    if(mySheet.getRange(tm[6]).getValue()=="TAXI"){
      mySheet.getRange(moves[6][idx]).setBackground("yellow")
      mySheet.getRange(moves[6][idx]).setFontColor("black")
    }else if (mySheet.getRange(tm[6]).getValue()=="BUS"){
      mySheet.getRange(moves[6][idx]).setBackground("green")
      mySheet.getRange(moves[6][idx]).setFontColor("white")
    }else {
      mySheet.getRange(moves[6][idx]).setBackground("pink")
      mySheet.getRange(moves[6][idx]).setFontColor("black")
    }
    
  }
  
  
}
  
    

function x_move_update(){
 
  clearstatusbox()
  new_position[0]= mrxSheet.getRange(position[0]).getValue()
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var counter, previous_move
  previous_move = mrxSheet.getRange(xSheet_moves[idx-1]).getValue()
  if(new_position[0] == previous_move){
    //This move cannot happen because the new position has not been updated by the player/detective
    mrxSheet.getRange(position[0]).clearContent()
    mrxSheet.getRange(position[0]).setBackground("red")
    mrxSheet.getRange(position[0]).setFontColor("red")
    //updatestatusbox("This move cannot happen because the new position has not been updated by the player/Mr X Please correct")
    
  }else if(new_position[0] == mySheet.getRange(moves[1][idx-1]).getValue() || new_position[0] == mySheet.getRange(moves[2][idx-1]).getValue() || new_position[0] == mySheet.getRange(moves[3][idx-1]).getValue() || new_position[0] == mySheet.getRange(moves[4][idx-1]).getValue() || new_position[0] == mySheet.getRange(moves[5][idx-1]).getValue() || new_position[0] == mySheet.getRange(moves[6][idx-1]).getValue()){
    //basically if Mr X. moves to a station which has a detective on it then detetctives win game
    mySheet.getRange(mv_counter).setBackground("green")
    for(i = 0; i < max_players; i++){
      if(i == 0){
        mrxSheet.getRange(position[i]).setBackground(d_wins[i])
      }
      mySheet.getRange(position[i]).setBackground(d_wins[i])
      mySheet.getRange(statusbox).setValue("Detectives have won and captured Mr X !!")
    }
    movering(0, station_row[new_position[0]-1] + orow, station_col[new_position[0] - 1] + ocol, 0, 0)
  }else{
    mrxSheet.getRange(position[0]).setBackground(bg[0])
    mrxSheet.getRange(position[0]).setFontColor(font_position[0])
    mySheet.getRange(move_flag[0]).setFontColor("green")
    mySheet.getRange(move_flag[0]).setBackground("green")    
    mySheet.getRange(move_flag[0]).setValue(1)
    if(mrxSheet.getRange(wildcard[0]).getValue() == "2X"){
      mySheet.getRange(x_2xmoves[idx]).setBackground("red")
      mrxSheet.getRange(xSheet_2xMoves[idx]).setBackground("red")
    }else{
      mySheet.getRange(x_2xmoves[idx]).clearContent()
      mrxSheet.getRange(xSheet_2xMoves[idx]).clearContent()
    
    }
    if(idx == 3 || idx == 8 || idx == 13 || idx == 18 || idx == 24){
      movering(0, station_row[new_position[0]-1] + orow, station_col[new_position[0] - 1] + ocol, 0, 0)
      mrxSheet.getRange(position[0]).setBackground("black")
      mrxSheet.getRange(position[0]).setFontColor("white")
      if(mrxSheet.getRange(tm[0]).getValue()=="TAXI"){
        mySheet.getRange(moves[0][idx]).setBackground("yellow")
        mySheet.getRange(moves[0][idx]).setFontColor("black")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("yellow")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("black")
        }else if (mrxSheet.getRange(tm[0]).getValue()=="BUS"){
          mySheet.getRange(moves[0][idx]).setBackground("green")
          mySheet.getRange(moves[0][idx]).setFontColor("white")
          mrxSheet.getRange(xSheet_moves[idx]).setBackground("green")
          mrxSheet.getRange(xSheet_moves[idx]).setFontColor("white")
        }else if (mySheet.getRange(tm[0]).getValue()=="METRO"){
        mySheet.getRange(moves[0][idx]).setBackground("pink")
        mySheet.getRange(moves[0][idx]).setFontColor("black")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("pink")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("black")
         
        }else{
        mySheet.getRange(moves[0][idx]).setBackground("black")
        mySheet.getRange(moves[0][idx]).setFontColor("white")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("black")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("white")
        }
    }else{
      if(mrxSheet.getRange(tm[0]).getValue()=="TAXI"){
        mySheet.getRange(moves[0][idx]).setBackground("yellow")
        mySheet.getRange(moves[0][idx]).setFontColor("yellow")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("yellow")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("black")
      }else if (mrxSheet.getRange(tm[0]).getValue()=="BUS"){
        mySheet.getRange(moves[0][idx]).setBackground("green")
        mySheet.getRange(moves[0][idx]).setFontColor("green")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("green")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("white")
      }else if (mrxSheet.getRange(tm[0]).getValue()=="METRO"){
        mySheet.getRange(moves[0][idx]).setBackground("pink")
        mySheet.getRange(moves[0][idx]).setFontColor("pink")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("pink")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("black")
         
      }else{
        mySheet.getRange(moves[0][idx]).setBackground("black")
        mySheet.getRange(moves[0][idx]).setFontColor("black")
        mrxSheet.getRange(xSheet_moves[idx]).setBackground("black")
        mrxSheet.getRange(xSheet_moves[idx]).setFontColor("white")
      }
    }
    mrxSheet.getRange(xSheet_moves[idx]).setValue(new_position[0])
    mySheet.getRange(moves[0][idx]).setValue(new_position[0])
    
  }
}  

function gameplay(){

  mySheet.getRange(mv_counter).setBackground("white")
  mySheet.getRange(mv_counter).setFontColor("black")
  var myKey = gameProperties.getProperty('global_counter')
  var idx = parseInt(myKey)
  var temp
  var vehicle, wc, flag = 0
  var a = 1, b = -2
  
  
  if((mySheet.getRange(move_flag[0]).getValue() == 1) && (mySheet.getRange(move_flag[1]).getValue() == 1) && (mySheet.getRange(move_flag[2]).getValue() == 1) && (mySheet.getRange(move_flag[3]).getValue() == 1) && (mySheet.getRange(move_flag[4]).getValue() == 1) && (mySheet.getRange(move_flag[5]).getValue() == 1) && (mySheet.getRange(move_flag[6]).getValue() == 1)){
      for(i=0; i < max_players; i++){
        if(i == 0){
          vehicle = mrxSheet.getRange(tm[i]).getValue()
          if(vehicle == "TAXI"){
            temp = mrxSheet.getRange(taxi_balance[i]).getValue() - 1
            mrxSheet.getRange(taxi_balance[i]).setValue(temp)
          }else if(vehicle == "BUS"){
            temp = mrxSheet.getRange(bus_balance[i]).getValue() - 1
            mrxSheet.getRange(bus_balance[i]).setValue(temp)
          }else if(vehicle == "METRO"){
            temp = mrxSheet.getRange(metro_balance[i]).getValue() - 1
            mrxSheet.getRange(metro_balance[i]).setValue(temp)
          }else {
            temp = mrxSheet.getRange(black_balance[i]).getValue() - 1
            mrxSheet.getRange(black_balance[i]).setValue(temp)
          }
          
          wc = mrxSheet.getRange(wildcard[i]).getValue()
          if(wc == "2X"){
            temp = mrxSheet.getRange(x2_balance[i]).getValue() - 1
            mrxSheet.getRange(x2_balance[i]).setValue(temp)
          }
          
        }else{
          vehicle = mySheet.getRange(tm[i]).getValue()
          if(vehicle == "TAXI"){
            temp = mySheet.getRange(taxi_balance[i]).getValue() - 1
            mySheet.getRange(taxi_balance[i]).setValue(temp)
            temp = mrxSheet.getRange(taxi_balance[0]).getValue() + 1
            mrxSheet.getRange(taxi_balance[0]).setValue(temp)
          }else if(vehicle == "BUS"){
            temp = mySheet.getRange(bus_balance[i]).getValue() - 1
            mySheet.getRange(bus_balance[i]).setValue(temp)
            temp = mrxSheet.getRange(bus_balance[0]).getValue() + 1
            mrxSheet.getRange(bus_balance[0]).setValue(temp)
          }else{
            temp = mySheet.getRange(metro_balance[i]).getValue() - 1
            mySheet.getRange(metro_balance[i]).setValue(temp)
            temp = mrxSheet.getRange(metro_balance[0]).getValue() + 1
            mrxSheet.getRange(metro_balance[0]).setValue(temp)
          }
        }
        
    }
    
    for(i = 0; i < max_players; i++){
      if(i == 0){
        new_position[i] = mrxSheet.getRange(xSheet_moves[idx]).getValue()
      
      }else{
        new_position[i] = mySheet.getRange(moves[i][idx]).getValue()
      
      }
      
      if((i != 0) && (new_position[i] == new_position[0])){
        flag = 1
      }
    }
    
    if(flag == 1){
      mySheet.getRange(mv_counter).setBackground("green")
      mySheet.getRange(mv_counter).setFontColor("green")
      for(i = 0; i < max_players; i++){
        if(i == 0){
          mrxSheet.getRange(position[i]).setBackground(d_wins[i])
        }
        mySheet.getRange(position[i]).setBackground(d_wins[i])
        mySheet.getRange(statusbox).setValue("Detectives have won and captured Mr X !!")
        
      }
      movering(0, station_row[new_position[0]-1] + orow, station_col[new_position[0] - 1] + ocol, 0, 0)
      
    }else if((flag != 1) && (idx != 24)){
      mySheet.getRange(mv_counter).setBackground("yellow")
      movering(0, parking[0][0] + a, parking[0][1] + b, 0, 0)
      
    }else{
      mySheet.getRange(mv_counter).setBackground("black")
      mySheet.getRange(mv_counter).setFontColor("white")
      mySheet.getRange(mv_counter).setValue('X')
      for(i = 0; i < max_players; i++){
        if(i == 0){
          mrxSheet.getRange(position[i]).setBackground(x_wins[i])
        }
        mySheet.getRange(position[i]).setBackground(x_wins[i])
        mySheet.getRange(statusbox).setValue("Mr X has won and successfully escaped !!")
        
      }
    }
    
    if(idx != 24){
      idx += 1
      mySheet.getRange(mv_counter).setValue(idx)
      gameProperties.setProperty('global_counter', idx.toString());
      global_counter = idx
    }else{
      mySheet.getRange(mv_counter).setValue("GAME OVER")
    }
    
    
    for(i = 0; i < max_players; i++){
      if(i == 0){
        mrxSheet.getRange(tm[i]).clearContent()
        mrxSheet.getRange(position[i]).clearContent()
        mrxSheet.getRange(position[i]).setBackground("white")
      
      }else{
        
        mySheet.getRange(tm[i]).clearContent()
        mySheet.getRange(position[i]).clearContent()
        mySheet.getRange(position[i]).setBackground("white")
      }
      mySheet.getRange(move_flag[i]).clearContent()
      mySheet.getRange(move_flag[i]).setBackground("white")
    }
  }else{
    mySheet.getRange(statusbox).setValue("Missing player move. Please update and re-press the \"Log Move & Proceed Button\"")
    
  }
  

  
}





